<!doctype html><html lang="es"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Detalle de trabajo</title><link rel="stylesheet" href="css/style.css"/></head><body>
<div id="navbar"></div>
<main class="container">
  <div class="card">
    <div id="job-detail"></div>
  </div>
  <div class="card">
    <h3>Postularme</h3>
    <form id="apply-form">
      <input type="hidden" name="jobId" id="apply-jobId" value=""/>
      <label>Nombre <input class="input" name="name" required/></label>
      <label>Email <input class="input" name="email" type="email" required/></label>
      <label>Mensaje <textarea class="input" name="message" rows="4"></textarea></label>
      <div style="margin-top:.6rem"><button class="btn" type="submit">Enviar postulación</button></div>
    </form>
  </div>
  <div class="card" id="candidates-panel" style="display:none">
    <h3>Candidatos</h3>
    <div id="applications-list"></div>
  </div>
</main>
<script>

function qParam(key){ const url=new URL(location.href); return url.searchParams.get(key); }
function showJobDetail(){
  const id = qParam('id');
  if(!id) { document.getElementById('job-detail').innerHTML = '<div class="empty">ID de trabajo no especificado.</div>'; return; }
  const jobs = JSON.parse(localStorage.getItem('demo_jobs_v1')||'[]');
  const job = jobs.find(j=>j.id===id);
  if(!job) { document.getElementById('job-detail').innerHTML = '<div class="empty">Trabajo no encontrado.</div>'; return; }
  document.getElementById('job-detail').innerHTML = `<h2>${escapeHtml(job.title)}</h2><div class="small">${escapeHtml(job.company)} · ${escapeHtml(job.location)} · ${escapeHtml(job.type)}</div><div style="margin-top:.6rem">${escapeHtml(job.description)}</div>`;
  document.getElementById('apply-jobId').value = id;
  // show candidates if current user is employer (simple check: if session user email contains company name part)
  const user = JSON.parse(localStorage.getItem('demo_user_v1')||'null');
  if(user && user.email && job.company && user.email.includes(job.company.split(' ')[0].toLowerCase())){
    document.getElementById('candidates-panel').style.display = 'block';
    // render applications
    const apps = JSON.parse(localStorage.getItem('demo_applications_v1')||'[]').filter(a=>a.jobId===id);
    const container = document.getElementById('applications-list');
    if(apps.length===0) container.innerHTML = '<div class="empty">No hay candidatos.</div>'; else {
      container.innerHTML = apps.map(a=>`<div class="card"><strong>${escapeHtml(a.name)}</strong> <div class="small">${escapeHtml(a.email)}</div><div style="margin-top:.4rem">${escapeHtml(a.message||'')}</div><div style="margin-top:.6rem"><a class="btn btn-outline" href="mailto:${escapeHtml(a.email)}">Contactar</a></div></div>`).join('');
    }
  }
}
showJobDetail();
</script>
<script src="js/nav.js"></script>
  <script src="js/app.js"></script></body></html>